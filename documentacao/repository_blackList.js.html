<h2>scr/repository/blackList.html</h2>

<pre><code class="lang-js">const BlackList = require('../model/BlackList');

const listarToken = token => {
    return BlackList.find({ token }).then(listado => {
        if (!listado.length) {
            const listedToken = new BlackList({ token });
            listedToken.save();
        }
        return true;
    });
};

const checarToken = token => {
    return BlackList.find({ token }).then(listado => listado.length > 0);
};

module.exports = { listarToken, checarToken };
</code></pre>

<h3>Visão Geral</h3>

<p>
    Este módulo é o repositório que irá fornecer uma camada de abstração da
    entidade BlackList. Esta entidade tem como propóstio armazenar os tokens que
    serão desvalidados quando o usuário fizer o logout e verificar se o cliente
    está usando um token listado na blacklist ou não.
</p>

<h3>Comentários</h3>

<ul>
    <li>
        <span class="lf-strong">Linha 1</span>: Importamos o objeto modelo
        através do qual poderemos realizar ações de escrita e leitura no banco
        de dados.
        <pre><code class="lang-js">const BlackList = require('../model/BlackList');</code></pre>
    </li>
    <li>
        <span class="lf-strong">Linhas 3 a 11</span>: Criamos a função
        listarToken que será responsável por inserir na lista negra (blacklist)
        o token no momento que um usuário autenticado estiver deslogando da API.
        A função irá primeiro verificar se o token já está listado, se não
        estiver então criará um novo registro objeto para listar o token e
        salvará esse objeto como um documento no banco. Por fim, se tudo ocorrer
        bem, irá retornar true para indicar que o token foi listado
        <pre><code class="lang-js">const listarToken = token => {
    return BlackList.find({ token }).then(listado => {
        if (!listado.length) {
            const listedToken = new BlackList({ token });
            listedToken.save();
        }
        return true;
    });
};</code></pre>
    </li>
    <li>
        <span class="lf-strong">Linhas 13 a 15</span>: Criamos a função
        checarToken que irá verificar se o token passado em seu parâmetro está
        listado na lista negra.
        <pre><code class="lang-js">const checarToken = token => {
    return BlackList.find({ token }).then(listado => listado.length > 0);
};</code></pre>
    </li>
    <li>
        <span class="lf-strong">Linha 17</span>: Exportamos as funções
        listarToken e checarToken para que possam ser usadas em outros módulos
        da aplicação
        <pre><code class="lang-js">module.exports = { listarToken, checarToken };</code></pre>
    </li>
</ul>
